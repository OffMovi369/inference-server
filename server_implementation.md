# Описание работы сервера
Здесь будет описано: 
- как сервер будет принимать и отправлять данные
- как он будет взаимодействовать с нейросетевым детектором
- архитектура сервера

**Используемый фреймворк:** RabbitMQ
**Язык программирования:** python 3.11+
**Библиотека для python:** ~~pika~~ Propan

## Смена фреймворка на Propan
Вместо `pika` будет использован `Propan`, так как он удобен и прост.

## Концепция
Так как в системе распределения сообщений RabbitMQ есть приёмник и отправитель, то на **сервере должен быть и тот, и другой**, так как серверу необходимо получать изображения и отправлять координаты найденного автотраспорта на фрейме.

## Архитектура сервера
`reciver` -> `detector` -> `sender`

`reciver`: Получатель сообщений, а именно изображений. Его задача: слушать канал и брать из очереди сообщение
`detector`: Детектор, задачей которого является получить на вход изображение и выдать список всего авто на этом фрейме
`sender`: Отправитель, который должен отправить полученный из детектора список обратно клиенту 

## Обработка одного клиента
Для начала необходимо создать две очереди. Очередь ответа и очередь запроса. Они будут определяться однозначно на стороне клиента и сервера.
Определим очередь `request` на стороне сервера и повешаем на него обработчик.

# Первые шаги
---
Был создан обменник и две очереди, а именно: `response-q` и `request-q`. В `detector.py` сам метод `model.detect` возвращает `box`, в котором все числа есть объекты класса `numpy.int32`, а это не является серриализуемыми ланными, поэтому внутри детектора пришлось применить ко всем числам функцию `int()`, чтобы на стороне сервера можно было отправить сообщение.

От сервера мы будем получать список вида: `[ [ motor_transport, x1, y1, x2, y2 ] ]` где motor_transport - вид автотраспорта, а далее идут координаты рамки.

**Propan сразу же полученные данные преобразует в список!** Возможно, что это делает RabbitMQ, но это не точно нужно уточнить этот момент.

По сути связь клиент-сервер готова, теперь необходимо поработать над клиентом, чтобы визуализировать полученный результат.